<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>NavAdmin - GestiÃ³n de TrÃ¡fico</title>

    <!-- PWA Settings -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#FF9800">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="./style.css">

    <style>
        /* Admin specific adjustments */
        .admin-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 152, 0, 0.9);
            color: white;
            text-align: center;
            padding: 5px;
            font-size: 12px;
            font-weight: bold;
            z-index: 3000;
            pointer-events: none;
        }

        .controls {
            background: rgba(255, 152, 0, 0.25) !important;
        }
    </style>
</head>

<body class="admin-mode">
    <div class="admin-header">MODO ADMINISTRADOR</div>
    <div id="map"></div>

    <!-- Top Right Actions Wrapper -->
    <div id="top-right-controls">
        <!-- UI Toggle Button -->
        <button id="ui-toggle-btn" onclick="toggleUI()" title="Ocultar Iconos">ğŸ‘ï¸</button>

        <!-- Center Map Button -->
        <button id="center-btn" title="Centrar Mapa" onclick="centerMap()">ğŸ¯</button>
    </div>

    <!-- GPS Status (Top Center) -->
    <div id="status-pill">...</div>
    <div id="status" class="hidden"></div>

    <!-- UI Controls Sidebar (Always Admin in this page) -->
    <div class="controls" id="main-controls">
        <div id="admin-controls">
            <button id="btn-pause-gps" title="Pausar GPS" onclick="toggleAdminGPS()"
                style="background-color: #607D8B;">ğŸ“</button>
            <button title="Importar OSM" onclick="importOSMRules()" style="background-color: #FF9800;">ğŸŒ</button>
            <button title="Cargar rules.js" onclick="resetRulesFromFile()"
                style="background-color: #9C27B0;">ğŸ”„</button>
            <button title="Descargar Config" onclick="downloadConfig()" style="background-color: #2196F3;">ğŸ’¾</button>
            <button title="Borrar Todo" onclick="clearAllRules()" style="background-color: #f44336;">ğŸ—‘ï¸</button>
        </div>
    </div>

    <!-- Admin: Rule Creation Modal -->
    <div id="rule-modal" class="hidden">
        <div class="modal-content">
            <h3>AÃ±adir Regla de TrÃ¡fico</h3>
            <select id="rule-type">
                <option value="forbidden">â›” DirecciÃ³n Prohibida</option>
                <option value="mandatory">â¬‡ï¸ DirecciÃ³n Obligatoria</option>
            </select>
            <div class="direction-inputs">
                <p>DirecciÃ³n (Rumbo): <span id="angle-display">0</span>Â°</p>
                <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <input type="range" id="rule-angle" min="0" max="360" value="0" oninput="updateAnglePreview()">
                    <div id="angle-preview"
                        style="width: 30px; height: 30px; border: 2px solid #333; border-radius: 50%; display: flex; justify-content: center; align-items: center; background: #eee;">
                        <div id="angle-arrow" style="font-size: 20px; font-weight: bold; transform-origin: center;">
                            â¬†ï¸
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button onclick="saveRule()" style="background-color: #4CAF50;">âœ… Guardar</button>
                <button onclick="closeModal()" style="background-color: #777;">âŒ Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Version Info -->
    <div id="version-label">VersiÃ³n: 1.11</div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Global Configuration -->
    <script>
        window.isAplicationAdmin = true;
    </script>

    <!-- Firebase SDK (Lite via CDN) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // This will be accessible from app.js once loaded
        window.FirebaseSDK = { initializeApp, getDatabase, ref, set, onValue };

        // Signal Firebase readiness if app.js is already waiting
        if (window.onFirebaseSDKLoaded) window.onFirebaseSDKLoaded();
    </script>

    <script src="./rules.js"></script>
    <script src="./app.js"></script>
</body>

</html>